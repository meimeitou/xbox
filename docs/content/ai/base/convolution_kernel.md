+++
title = 'å·ç§¯æ ¸'
math = true
+++

å·ç§¯æ ¸ï¼šå›¾åƒä¸–ç•Œçš„é­”æ³•å·¥å…·ç®±

- [å¼•è¨€](#å¼•è¨€)
- [ä»€ä¹ˆæ˜¯å·ç§¯æ ¸ï¼Ÿ](#ä»€ä¹ˆæ˜¯å·ç§¯æ ¸)
  - [ç”Ÿæ´»ä¸­çš„å·ç§¯æ ¸ç±»æ¯”](#ç”Ÿæ´»ä¸­çš„å·ç§¯æ ¸ç±»æ¯”)
- [åŸºç¡€å·ç§¯æ ¸è¯¦è§£](#åŸºç¡€å·ç§¯æ ¸è¯¦è§£)
- [å·ç§¯æ ¸çš„è®¾è®¡åŸç†](#å·ç§¯æ ¸çš„è®¾è®¡åŸç†)
  - [1. å·ç§¯æ ¸çš„åŸºæœ¬è§„åˆ™](#1-å·ç§¯æ ¸çš„åŸºæœ¬è§„åˆ™)
- [ç»å…¸å·ç§¯æ ¸å¤§å…¨](#ç»å…¸å·ç§¯æ ¸å¤§å…¨)
  - [1. è¾¹ç¼˜æ£€æµ‹æ ¸æ—è°±](#1-è¾¹ç¼˜æ£€æµ‹æ ¸æ—è°±)
  - [2. æ¨¡ç³Šæ ¸å®¶æ—](#2-æ¨¡ç³Šæ ¸å®¶æ—)
- [å·ç§¯æ ¸çš„ç»„åˆä¸çº§è”](#å·ç§¯æ ¸çš„ç»„åˆä¸çº§è”)
  - [å¤åˆæ•ˆæœçš„åˆ›é€ ](#å¤åˆæ•ˆæœçš„åˆ›é€ )
- [å¯å­¦ä¹ çš„å·ç§¯æ ¸](#å¯å­¦ä¹ çš„å·ç§¯æ ¸)
  - [ä»å›ºå®šåˆ°è‡ªé€‚åº”](#ä»å›ºå®šåˆ°è‡ªé€‚åº”)
- [ç°ä»£æ·±åº¦å­¦ä¹ ä¸­çš„å·ç§¯æ ¸](#ç°ä»£æ·±åº¦å­¦ä¹ ä¸­çš„å·ç§¯æ ¸)
  - [1. ä¸åŒå°ºå¯¸çš„å·ç§¯æ ¸](#1-ä¸åŒå°ºå¯¸çš„å·ç§¯æ ¸)
  - [2. æ·±åº¦å¯åˆ†ç¦»å·ç§¯æ ¸](#2-æ·±åº¦å¯åˆ†ç¦»å·ç§¯æ ¸)
- [å·ç§¯æ ¸çš„å¯è§†åŒ–æŠ€å·§](#å·ç§¯æ ¸çš„å¯è§†åŒ–æŠ€å·§)
  - [ç†è§£å·ç§¯æ ¸çš„ä½œç”¨æœºåˆ¶](#ç†è§£å·ç§¯æ ¸çš„ä½œç”¨æœºåˆ¶)
- [å®æˆ˜æŠ€å·§ï¼šå¦‚ä½•è®¾è®¡å·ç§¯æ ¸](#å®æˆ˜æŠ€å·§å¦‚ä½•è®¾è®¡å·ç§¯æ ¸)
  - [æ ¹æ®éœ€æ±‚å®šåˆ¶å·ç§¯æ ¸](#æ ¹æ®éœ€æ±‚å®šåˆ¶å·ç§¯æ ¸)
- [æ€»ç»“ï¼šå·ç§¯æ ¸çš„æ™ºæ…§](#æ€»ç»“å·ç§¯æ ¸çš„æ™ºæ…§)
  - [ğŸ¯ æ ¸å¿ƒæœ¬è´¨](#-æ ¸å¿ƒæœ¬è´¨)
  - [ğŸ”§ è®¾è®¡åŸåˆ™](#-è®¾è®¡åŸåˆ™)
  - [ğŸ’ª åº”ç”¨ç­–ç•¥](#-åº”ç”¨ç­–ç•¥)
  - [ğŸ§  æ·±åº¦å­¦ä¹ ä¸­çš„è¿›åŒ–](#-æ·±åº¦å­¦ä¹ ä¸­çš„è¿›åŒ–)
  - [ğŸª è®°å¿†å£è¯€](#-è®°å¿†å£è¯€)

## å¼•è¨€

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ˜¯ä¸€ä½é­”æ³•å¸ˆï¼Œæ‰‹ä¸­æœ‰å„ç§ä¸åŒçš„é­”æ³•é“å…·ã€‚æ¯ä¸ªé“å…·éƒ½æœ‰ç‰¹æ®Šçš„èƒ½åŠ›ï¼šæœ‰çš„èƒ½è®©å›¾åƒå˜å¾—æ›´æ¸…æ™°ï¼Œæœ‰çš„èƒ½çªå‡ºè¾¹ç¼˜ï¼Œæœ‰çš„èƒ½æ¨¡ç³ŠèƒŒæ™¯ã€‚è¿™äº›ç¥å¥‡çš„é­”æ³•é“å…·ï¼Œå°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦æ¢è®¨çš„**å·ç§¯æ ¸**ï¼

å·ç§¯æ ¸ï¼ˆConvolution Kernelï¼‰ä¹Ÿå«æ»¤æ³¢å™¨ï¼ˆFilterï¼‰ï¼Œæ˜¯å›¾åƒå¤„ç†å’Œæ·±åº¦å­¦ä¹ ä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ã€‚å®ƒè™½ç„¶åªæ˜¯ä¸€ä¸ªå°å°çš„æ•°å­—çŸ©é˜µï¼Œå´æ‹¥æœ‰ç€æ”¹å˜æ•´ä¸ªå›¾åƒçš„é­”æ³•åŠ›é‡ã€‚

## ä»€ä¹ˆæ˜¯å·ç§¯æ ¸ï¼Ÿ

å·ç§¯æ ¸æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª**å°çŸ©é˜µ**ï¼Œé‡Œé¢è£…æ»¡äº†æ•°å­—ã€‚è¿™äº›æ•°å­—ä¸æ˜¯éšæ„æ’åˆ—çš„ï¼Œè€Œæ˜¯ç²¾å¿ƒè®¾è®¡çš„"é­”æ³•å’’è¯­"ï¼Œæ¯ä¸€ä¸ªéƒ½æœ‰ç‰¹å®šçš„å«ä¹‰å’Œä½œç”¨ã€‚

### ç”Ÿæ´»ä¸­çš„å·ç§¯æ ¸ç±»æ¯”

1. **ç…§ç›¸æœºæ»¤é•œ** ğŸ“¸
   - åæŒ¯é•œ = å»é™¤åå…‰çš„å·ç§¯æ ¸
   - æŸ”å…‰é•œ = æ¨¡ç³Šæ•ˆæœçš„å·ç§¯æ ¸
   - æ˜Ÿå…‰é•œ = ç‰¹æ®Šå…‰æ•ˆçš„å·ç§¯æ ¸

2. **å’–å•¡æ»¤çº¸** â˜•
   - ä¸åŒç½‘æ ¼çš„æ»¤çº¸ = ä¸åŒçš„å·ç§¯æ ¸
   - ç»†ç½‘æ ¼ç•™ä¸‹æ¸…æ¾ˆå’–å•¡ = å¹³æ»‘å·ç§¯æ ¸
   - ç²—ç½‘æ ¼ä¿ç•™é¢—ç²’ = é”åŒ–å·ç§¯æ ¸

3. **éŸ³å“å‡è¡¡å™¨** ğŸµ
   - ä½éŸ³å¢å¼º = æ¨¡ç³Šå·ç§¯æ ¸
   - é«˜éŸ³çªå‡º = è¾¹ç¼˜æ£€æµ‹å·ç§¯æ ¸
   - ä¸åŒé¢‘æ®µè°ƒèŠ‚ = ä¸åŒç‰¹å¾çš„å·ç§¯æ ¸

## åŸºç¡€å·ç§¯æ ¸è¯¦è§£

è®©æˆ‘ä»¬ä»æœ€ç®€å•çš„å·ç§¯æ ¸å¼€å§‹ï¼Œé€æ­¥ç†è§£å®ƒä»¬çš„é­”æ³•ï¼š

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import ndimage
import cv2

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False

def create_test_image():
    """åˆ›å»ºæµ‹è¯•å›¾åƒ"""
    # åˆ›å»ºä¸€ä¸ªåŒ…å«å„ç§ç‰¹å¾çš„æµ‹è¯•å›¾åƒ
    img = np.zeros((100, 100))
    
    # æ·»åŠ æ°´å¹³çº¿
    img[20:25, 20:80] = 1
    
    # æ·»åŠ å‚ç›´çº¿
    img[20:80, 20:25] = 1
    
    # æ·»åŠ å¯¹è§’çº¿
    for i in range(30):
        img[40+i, 40+i] = 1
    
    # æ·»åŠ çŸ©å½¢
    img[60:75, 60:75] = 0.7
    
    # æ·»åŠ å™ªå£°
    noise = np.random.normal(0, 0.05, img.shape)
    img = np.clip(img + noise, 0, 1)
    
    return img

def apply_kernel(image, kernel, title):
    """åº”ç”¨å·ç§¯æ ¸å¹¶æ˜¾ç¤ºç»“æœ"""
    result = ndimage.convolve(image, kernel, mode='constant')
    return result

# åˆ›å»ºæµ‹è¯•å›¾åƒ
test_img = create_test_image()

# å®šä¹‰åŸºç¡€å·ç§¯æ ¸
basic_kernels = {
    'åŸå›¾': np.array([[0, 0, 0],
                    [0, 1, 0],
                    [0, 0, 0]]),
    
    'å‡å€¼æ¨¡ç³Š': np.ones((3, 3)) / 9,
    
    'é«˜æ–¯æ¨¡ç³Š': np.array([[1, 2, 1],
                       [2, 4, 2],
                       [1, 2, 1]]) / 16,
    
    'é”åŒ–': np.array([[ 0, -1,  0],
                     [-1,  5, -1],
                     [ 0, -1,  0]]),
    
    'è¾¹ç¼˜æ£€æµ‹': np.array([[-1, -1, -1],
                        [-1,  8, -1],
                        [-1, -1, -1]]),
    
    'æµ®é›•': np.array([[-2, -1,  0],
                     [-1,  1,  1],
                     [ 0,  1,  2]]),
}

# å¯è§†åŒ–åŸºç¡€å·ç§¯æ ¸æ•ˆæœ
fig, axes = plt.subplots(2, 3, figsize=(15, 10))
axes = axes.flatten()

for i, (name, kernel) in enumerate(basic_kernels.items()):
    if name == 'åŸå›¾':
        result = test_img
    else:
        result = apply_kernel(test_img, kernel, name)
    
    axes[i].imshow(result, cmap='gray')
    axes[i].set_title(f'{name}')
    axes[i].axis('off')
    
    # æ˜¾ç¤ºå·ç§¯æ ¸
    print(f"{name}å·ç§¯æ ¸:")
    print(kernel)
    print(f"æ ¸çš„å’Œ: {np.sum(kernel):.2f}")
    print("-" * 30)

plt.tight_layout()
plt.show()
```

## å·ç§¯æ ¸çš„è®¾è®¡åŸç†

### 1. å·ç§¯æ ¸çš„åŸºæœ¬è§„åˆ™

```python
def explain_kernel_principles():
    """è§£é‡Šå·ç§¯æ ¸çš„è®¾è®¡åŸç†"""
    
    print("å·ç§¯æ ¸è®¾è®¡çš„é»„é‡‘æ³•åˆ™:")
    print("=" * 50)
    
    # è§„åˆ™1: æ ¸çš„å’Œå†³å®šäº®åº¦
    kernels_sum = {
        'ä¿æŒäº®åº¦': np.array([[0, -1, 0], [-1, 5, -1], [0, -1, 0]]),  # å’Œ=1
        'å˜æš—': np.array([[-1, -1, -1], [-1, -1, -1], [-1, -1, -1]]) / 9,  # å’Œ<0
        'å˜äº®': np.array([[1, 1, 1], [1, 2, 1], [1, 1, 1]]) / 10,  # å’Œ>1
    }
    
    print("1. å·ç§¯æ ¸çš„å’Œå†³å®šå›¾åƒæ•´ä½“äº®åº¦:")
    for name, kernel in kernels_sum.items():
        kernel_sum = np.sum(kernel)
        print(f"   {name}: å’Œ={kernel_sum:.2f}")
    
    # è§„åˆ™2: å¯¹ç§°æ€§å†³å®šæ–¹å‘æ€§
    print(f"\n2. å·ç§¯æ ¸çš„å¯¹ç§°æ€§:")
    symmetric_kernel = np.array([[1, 2, 1], [2, 4, 2], [1, 2, 1]]) / 16
    asymmetric_kernel = np.array([[1, 0, -1], [2, 0, -2], [1, 0, -1]]) / 6
    
    print(f"   å¯¹ç§°æ ¸: æ— æ–¹å‘æ€§ (å¦‚é«˜æ–¯æ¨¡ç³Š)")
    print(f"   éå¯¹ç§°æ ¸: æœ‰æ–¹å‘æ€§ (å¦‚è¾¹ç¼˜æ£€æµ‹)")
    
    # è§„åˆ™3: ä¸­å¿ƒæƒé‡çš„é‡è¦æ€§
    print(f"\n3. ä¸­å¿ƒæƒé‡å†³å®šä¿ç•™ç¨‹åº¦:")
    print(f"   ä¸­å¿ƒæƒé‡å¤§: ä¿ç•™åŸå§‹ä¿¡æ¯å¤š")
    print(f"   ä¸­å¿ƒæƒé‡å°: æ›´å¤šä¾èµ–é‚»åŸŸä¿¡æ¯")
    
    # å¯è§†åŒ–ä¸åŒæ ¸çš„æ•ˆæœ
    test_pattern = np.zeros((50, 50))
    test_pattern[20:30, 20:30] = 1  # ä¸€ä¸ªç™½è‰²æ–¹å—
    
    fig, axes = plt.subplots(2, 3, figsize=(15, 8))
    
    # åŸå›¾
    axes[0, 0].imshow(test_pattern, cmap='gray')
    axes[0, 0].set_title('åŸå§‹å›¾æ¡ˆ')
    axes[0, 0].axis('off')
    
    # åº”ç”¨ä¸åŒçš„æ ¸
    kernels_demo = {
        'ä¿æŒäº®åº¦': kernels_sum['ä¿æŒäº®åº¦'],
        'å˜æš—': kernels_sum['å˜æš—'] * 9,  # æ”¾å¤§ä»¥ä¾¿è§‚å¯Ÿ
        'å˜äº®': kernels_sum['å˜äº®'] * 10,
        'å¯¹ç§°æ¨¡ç³Š': symmetric_kernel,
        'éå¯¹ç§°è¾¹ç¼˜': asymmetric_kernel * 3,  # æ”¾å¤§æ•ˆæœ
    }
    
    for i, (name, kernel) in enumerate(kernels_demo.items(), 1):
        result = ndimage.convolve(test_pattern, kernel, mode='constant')
        
        if i <= 3:
            axes[0, i].imshow(result, cmap='gray')
            axes[0, i].set_title(name)
            axes[0, i].axis('off')
        else:
            axes[1, i-4].imshow(result, cmap='gray')
            axes[1, i-4].set_title(name)
            axes[1, i-4].axis('off')
    
    axes[1, 2].axis('off')  # éšè—æœ€åä¸€ä¸ªå­å›¾
    
    plt.tight_layout()
    plt.show()

explain_kernel_principles()
```

## ç»å…¸å·ç§¯æ ¸å¤§å…¨

### 1. è¾¹ç¼˜æ£€æµ‹æ ¸æ—è°±

```python
def edge_detection_kernels():
    """è¾¹ç¼˜æ£€æµ‹å·ç§¯æ ¸å¤§å…¨"""
    
    edge_kernels = {
        'Sobel X': np.array([[-1, 0, 1],
                            [-2, 0, 2],
                            [-1, 0, 1]]),
        
        'Sobel Y': np.array([[-1, -2, -1],
                            [ 0,  0,  0],
                            [ 1,  2,  1]]),
        
        'Prewitt X': np.array([[-1, 0, 1],
                              [-1, 0, 1],
                              [-1, 0, 1]]),
        
        'Prewitt Y': np.array([[-1, -1, -1],
                              [ 0,  0,  0],
                              [ 1,  1,  1]]),
        
        'Roberts X': np.array([[1, 0],
                              [0, -1]]),
        
        'Roberts Y': np.array([[0, 1],
                              [-1, 0]]),
        
        'Laplacian': np.array([[ 0, -1,  0],
                              [-1,  4, -1],
                              [ 0, -1,  0]]),
        
        'Laplacian 8é‚»åŸŸ': np.array([[-1, -1, -1],
                                   [-1,  8, -1],
                                   [-1, -1, -1]]),
    }
    
    # åˆ›å»ºåŒ…å«å„ç§è¾¹ç¼˜çš„æµ‹è¯•å›¾åƒ
    test_img = np.zeros((80, 80))
    
    # æ°´å¹³è¾¹ç¼˜
    test_img[20:22, 10:70] = 1
    
    # å‚ç›´è¾¹ç¼˜
    test_img[30:70, 20:22] = 1
    
    # å¯¹è§’è¾¹ç¼˜
    for i in range(25):
        test_img[40+i, 40+i] = 1
        test_img[40+i, 65-i] = 1
    
    # åœ†å½¢è¾¹ç¼˜
    center = (60, 60)
    for i in range(80):
        for j in range(80):
            if 45 <= (i-center[0])**2 + (j-center[1])**2 <= 64:
                test_img[i, j] = 1
    
    # å¯è§†åŒ–æ‰€æœ‰è¾¹ç¼˜æ£€æµ‹æ ¸çš„æ•ˆæœ
    fig, axes = plt.subplots(3, 3, figsize=(15, 15))
    axes = axes.flatten()
    
    # åŸå›¾
    axes[0].imshow(test_img, cmap='gray')
    axes[0].set_title('åŸå§‹å›¾åƒ')
    axes[0].axis('off')
    
    # åº”ç”¨å„ç§è¾¹ç¼˜æ£€æµ‹æ ¸
    for i, (name, kernel) in enumerate(edge_kernels.items(), 1):
        if kernel.shape == (2, 2):
            # Robertsç®—å­éœ€è¦ç‰¹æ®Šå¤„ç†
            result = ndimage.convolve(test_img[:-1, :-1], kernel, mode='constant')
            result = np.pad(result, ((0, 1), (0, 1)), mode='constant')
        else:
            result = ndimage.convolve(test_img, kernel, mode='constant')
        
        # å½’ä¸€åŒ–æ˜¾ç¤º
        result = np.abs(result)
        if result.max() > 0:
            result = result / result.max()
        
        axes[i].imshow(result, cmap='gray')
        axes[i].set_title(f'{name}')
        axes[i].axis('off')
        
        print(f"{name}:")
        print(kernel)
        print(f"ç‰¹ç‚¹: {'æ°´å¹³è¾¹ç¼˜æ£€æµ‹' if 'Y' in name else 'å‚ç›´è¾¹ç¼˜æ£€æµ‹' if 'X' in name else 'å…¨æ–¹å‘è¾¹ç¼˜æ£€æµ‹'}")
        print("-" * 30)
    
    plt.tight_layout()
    plt.show()
    
    # ç»„åˆSobelç®—å­æ¼”ç¤º
    sobel_x = ndimage.convolve(test_img, edge_kernels['Sobel X'], mode='constant')
    sobel_y = ndimage.convolve(test_img, edge_kernels['Sobel Y'], mode='constant')
    sobel_combined = np.sqrt(sobel_x**2 + sobel_y**2)
    
    fig, axes = plt.subplots(1, 4, figsize=(16, 4))
    
    axes[0].imshow(test_img, cmap='gray')
    axes[0].set_title('åŸå›¾')
    axes[0].axis('off')
    
    axes[1].imshow(np.abs(sobel_x), cmap='gray')
    axes[1].set_title('Sobel X (å‚ç›´è¾¹ç¼˜)')
    axes[1].axis('off')
    
    axes[2].imshow(np.abs(sobel_y), cmap='gray')
    axes[2].set_title('Sobel Y (æ°´å¹³è¾¹ç¼˜)')
    axes[2].axis('off')
    
    axes[3].imshow(sobel_combined, cmap='gray')
    axes[3].set_title('ç»„åˆç»“æœ (æ‰€æœ‰è¾¹ç¼˜)')
    axes[3].axis('off')
    
    plt.tight_layout()
    plt.show()

edge_detection_kernels()
```

### 2. æ¨¡ç³Šæ ¸å®¶æ—

```python
def blur_kernels():
    """å„ç§æ¨¡ç³Šå·ç§¯æ ¸"""
    
    def gaussian_kernel(size, sigma):
        """ç”Ÿæˆé«˜æ–¯æ ¸"""
        kernel = np.zeros((size, size))
        center = size // 2
        
        for i in range(size):
            for j in range(size):
                x, y = i - center, j - center
                kernel[i, j] = np.exp(-(x**2 + y**2) / (2 * sigma**2))
        
        return kernel / np.sum(kernel)
    
    def motion_blur_kernel(size, angle):
        """ç”Ÿæˆè¿åŠ¨æ¨¡ç³Šæ ¸"""
        kernel = np.zeros((size, size))
        center = size // 2
        
        # è®¡ç®—çº¿çš„æ–¹å‘
        angle_rad = np.radians(angle)
        cos_angle = np.cos(angle_rad)
        sin_angle = np.sin(angle_rad)
        
        for i in range(size):
            x = int(center + (i - center) * cos_angle)
            y = int(center + (i - center) * sin_angle)
            if 0 <= x < size and 0 <= y < size:
                kernel[x, y] = 1
        
        return kernel / np.sum(kernel) if np.sum(kernel) > 0 else kernel
    
    # åˆ›å»ºå„ç§æ¨¡ç³Šæ ¸
    blur_kernels_dict = {
        'å‡å€¼æ¨¡ç³Š 3Ã—3': np.ones((3, 3)) / 9,
        'å‡å€¼æ¨¡ç³Š 5Ã—5': np.ones((5, 5)) / 25,
        'é«˜æ–¯æ¨¡ç³Š Ïƒ=1': gaussian_kernel(5, 1),
        'é«˜æ–¯æ¨¡ç³Š Ïƒ=2': gaussian_kernel(7, 2),
        'æ°´å¹³è¿åŠ¨æ¨¡ç³Š': motion_blur_kernel(9, 0),
        '45Â°è¿åŠ¨æ¨¡ç³Š': motion_blur_kernel(9, 45),
    }
    
    # åˆ›å»ºæ¸…æ™°çš„æµ‹è¯•å›¾åƒ
    clear_img = np.zeros((60, 60))
    # æ·»åŠ æ–‡å­—æ ·å¼çš„å›¾æ¡ˆ
    clear_img[15:20, 10:50] = 1  # æ°´å¹³æ¡
    clear_img[10:50, 15:20] = 1  # å‚ç›´æ¡
    clear_img[25:35, 25:35] = 1  # æ­£æ–¹å½¢
    clear_img[40:45, 40:50] = 1  # å°çŸ©å½¢
    
    # å¯è§†åŒ–æ‰€æœ‰æ¨¡ç³Šæ•ˆæœ
    fig, axes = plt.subplots(2, 3, figsize=(15, 10))
    axes = axes.flatten()
    
    for i, (name, kernel) in enumerate(blur_kernels_dict.items()):
        blurred = ndimage.convolve(clear_img, kernel, mode='constant')
        
        axes[i].imshow(blurred, cmap='gray')
        axes[i].set_title(f'{name}')
        axes[i].axis('off')
        
        print(f"{name}:")
        print(f"æ ¸å¤§å°: {kernel.shape}")
        print(f"æ ¸çš„å’Œ: {np.sum(kernel):.3f}")
        if kernel.shape[0] <= 5:  # åªæ˜¾ç¤ºå°æ ¸
            print(kernel)
        print("-" * 30)
    
    plt.tight_layout()
    plt.show()
    
    # æ¯”è¾ƒä¸åŒå¼ºåº¦çš„é«˜æ–¯æ¨¡ç³Š
    sigmas = [0.5, 1, 2, 3]
    fig, axes = plt.subplots(1, len(sigmas) + 1, figsize=(20, 4))
    
    axes[0].imshow(clear_img, cmap='gray')
    axes[0].set_title('åŸå›¾')
    axes[0].axis('off')
    
    for i, sigma in enumerate(sigmas, 1):
        gaussian = gaussian_kernel(int(6*sigma)+1, sigma)
        blurred = ndimage.convolve(clear_img, gaussian, mode='constant')
        
        axes[i].imshow(blurred, cmap='gray')
        axes[i].set_title(f'é«˜æ–¯æ¨¡ç³Š Ïƒ={sigma}')
        axes[i].axis('off')
    
    plt.tight_layout()
    plt.show()

blur_kernels()
```

## å·ç§¯æ ¸çš„ç»„åˆä¸çº§è”

### å¤åˆæ•ˆæœçš„åˆ›é€ 

```python
def kernel_combinations():
    """æ¼”ç¤ºå·ç§¯æ ¸çš„ç»„åˆæ•ˆæœ"""
    
    # åˆ›å»ºåŸºç¡€å›¾åƒ
    base_img = create_test_image()
    
    # åŸºç¡€æ ¸
    blur_kernel = np.ones((3, 3)) / 9
    sharpen_kernel = np.array([[ 0, -1,  0],
                              [-1,  5, -1],
                              [ 0, -1,  0]])
    edge_kernel = np.array([[-1, -1, -1],
                           [-1,  8, -1],
                           [-1, -1, -1]])
    
    # ç»„åˆç­–ç•¥
    combinations = {
        'åŸå›¾': lambda img: img,
        'å…ˆæ¨¡ç³Šåé”åŒ–': lambda img: ndimage.convolve(
            ndimage.convolve(img, blur_kernel, mode='constant'),
            sharpen_kernel, mode='constant'),
        'å…ˆé”åŒ–åæ¨¡ç³Š': lambda img: ndimage.convolve(
            ndimage.convolve(img, sharpen_kernel, mode='constant'),
            blur_kernel, mode='constant'),
        'æ¨¡ç³Š+è¾¹ç¼˜æ£€æµ‹': lambda img: ndimage.convolve(
            ndimage.convolve(img, blur_kernel, mode='constant'),
            edge_kernel, mode='constant'),
        'åŒé‡é”åŒ–': lambda img: ndimage.convolve(
            ndimage.convolve(img, sharpen_kernel, mode='constant'),
            sharpen_kernel, mode='constant'),
    }
    
    # å¯è§†åŒ–ç»„åˆæ•ˆæœ
    fig, axes = plt.subplots(2, 3, figsize=(15, 10))
    axes = axes.flatten()
    
    for i, (name, operation) in enumerate(combinations.items()):
        result = operation(base_img)
        
        axes[i].imshow(result, cmap='gray')
        axes[i].set_title(name)
        axes[i].axis('off')
        
        print(f"{name}:")
        print(f"æœ€å¤§å€¼: {result.max():.3f}, æœ€å°å€¼: {result.min():.3f}")
        print(f"å¹³å‡å€¼: {result.mean():.3f}, æ ‡å‡†å·®: {result.std():.3f}")
        print("-" * 30)
    
    axes[5].axis('off')  # éšè—æœ€åä¸€ä¸ªå­å›¾
    
    plt.tight_layout()
    plt.show()
    
    # æ¼”ç¤ºå·ç§¯æ ¸æ•°å­¦ç»„åˆ
    print("å·ç§¯æ ¸çš„æ•°å­¦ç»„åˆ:")
    print("=" * 40)
    
    # ä¸¤ä¸ªæ ¸çš„å·ç§¯ç­‰äºå…ˆååº”ç”¨ä¸¤ä¸ªæ ¸
    combined_kernel = ndimage.convolve(sharpen_kernel, blur_kernel, mode='constant')
    
    # æ–¹æ³•1: ç›´æ¥åº”ç”¨ç»„åˆæ ¸
    result1 = ndimage.convolve(base_img, combined_kernel, mode='constant')
    
    # æ–¹æ³•2: å…ˆååº”ç”¨ä¸¤ä¸ªæ ¸
    temp = ndimage.convolve(base_img, blur_kernel, mode='constant')
    result2 = ndimage.convolve(temp, sharpen_kernel, mode='constant')
    
    print(f"ç»„åˆæ ¸ä¸é€æ­¥åº”ç”¨çš„å·®å¼‚: {np.mean(np.abs(result1 - result2)):.6f}")
    print("(ç†è®ºä¸Šåº”è¯¥ç›¸ç­‰ï¼Œå·®å¼‚æ¥è‡ªè¾¹ç•Œå¤„ç†)")

kernel_combinations()
```

## å¯å­¦ä¹ çš„å·ç§¯æ ¸

### ä»å›ºå®šåˆ°è‡ªé€‚åº”

```python
def learnable_kernels_demo():
    """æ¼”ç¤ºå¯å­¦ä¹ å·ç§¯æ ¸çš„æ¦‚å¿µ"""
    
    # æ¨¡æ‹ŸCNNä¸­å·ç§¯æ ¸çš„å­¦ä¹ è¿‡ç¨‹
    def simulate_learning_process():
        """æ¨¡æ‹Ÿæ·±åº¦å­¦ä¹ ä¸­å·ç§¯æ ¸çš„æ¼”åŒ–"""
        
        # åˆå§‹éšæœºæ ¸
        np.random.seed(42)
        initial_kernel = np.random.randn(3, 3) * 0.1
        
        # æ¨¡æ‹Ÿå­¦ä¹ è¿‡ç¨‹ä¸­æ ¸çš„å˜åŒ–
        learning_steps = [
            ('åˆå§‹åŒ–(éšæœº)', initial_kernel),
            ('å­¦ä¹ æ—©æœŸ', np.array([[-0.1, 0.0, 0.1],
                                  [-0.2, 0.0, 0.2], 
                                  [-0.1, 0.0, 0.1]])),  # è¶‹å‘å‚ç›´è¾¹ç¼˜æ£€æµ‹
            ('å­¦ä¹ ä¸­æœŸ', np.array([[-0.2, 0.0, 0.2],
                                  [-0.4, 0.0, 0.4],
                                  [-0.2, 0.0, 0.2]])),  # æ›´å¼ºçš„å‚ç›´è¾¹ç¼˜æ£€æµ‹
            ('å­¦ä¹ å®Œæˆ', np.array([[-1, 0, 1],
                                  [-2, 0, 2],
                                  [-1, 0, 1]])),  # ç±»ä¼¼Sobelæ ¸
        ]
        
        return learning_steps
    
    # åˆ›å»ºåŒ…å«å‚ç›´è¾¹ç¼˜çš„è®­ç»ƒæ ·æœ¬
    training_sample = np.zeros((50, 50))
    training_sample[:, 20:23] = 1  # å‚ç›´è¾¹ç¼˜
    training_sample[:, 30:33] = 1  # å¦ä¸€ä¸ªå‚ç›´è¾¹ç¼˜
    
    learning_steps = simulate_learning_process()
    
    fig, axes = plt.subplots(2, 4, figsize=(16, 8))
    
    for i, (stage, kernel) in enumerate(learning_steps):
        # åº”ç”¨æ ¸
        result = ndimage.convolve(training_sample, kernel, mode='constant')
        
        # æ˜¾ç¤ºè®­ç»ƒæ ·æœ¬å’Œç»“æœ
        if i == 0:
            axes[0, i].imshow(training_sample, cmap='gray')
            axes[0, i].set_title('è®­ç»ƒæ ·æœ¬\n(åŒ…å«å‚ç›´è¾¹ç¼˜)')
        else:
            axes[0, i].imshow(training_sample, cmap='gray')
            axes[0, i].set_title(f'{stage}\nè¾“å…¥å›¾åƒ')
        axes[0, i].axis('off')
        
        # æ˜¾ç¤ºå·ç§¯ç»“æœ
        axes[1, i].imshow(np.abs(result), cmap='hot')
        axes[1, i].set_title(f'{stage}\nå“åº”å¼ºåº¦')
        axes[1, i].axis('off')
        
        print(f"{stage}:")
        print(kernel)
        print(f"å¯¹å‚ç›´è¾¹ç¼˜çš„æ€»å“åº”: {np.sum(np.abs(result)):.2f}")
        print("-" * 30)
    
    plt.tight_layout()
    plt.show()
    
    # æ¼”ç¤ºä¸åŒæ ¸çš„ç‰¹åŒ–æ–¹å‘
    specialized_kernels = {
        'æ°´å¹³è¾¹ç¼˜ä¸“å®¶': np.array([[-1, -2, -1],
                               [ 0,  0,  0],
                               [ 1,  2,  1]]),
        'å‚ç›´è¾¹ç¼˜ä¸“å®¶': np.array([[-1, 0, 1],
                               [-2, 0, 2],
                               [-1, 0, 1]]),
        'å¯¹è§’è¾¹ç¼˜ä¸“å®¶': np.array([[ 0, 1, 2],
                               [-1, 0, 1],
                               [-2, -1, 0]]),
        'çº¹ç†æ£€æµ‹ä¸“å®¶': np.array([[ 1, -2,  1],
                               [-2,  4, -2],
                               [ 1, -2,  1]]),
    }
    
    # åˆ›å»ºåŒ…å«ä¸åŒç‰¹å¾çš„æµ‹è¯•å›¾åƒ
    test_features = np.zeros((60, 60))
    test_features[15:17, 10:50] = 1    # æ°´å¹³è¾¹ç¼˜
    test_features[20:50, 15:17] = 1    # å‚ç›´è¾¹ç¼˜
    for i in range(20):                # å¯¹è§’è¾¹ç¼˜
        test_features[30+i, 30+i] = 1
    # æ·»åŠ çº¹ç†åŒºåŸŸ
    test_features[40:50, 40:50] = np.random.rand(10, 10) > 0.5
    
    fig, axes = plt.subplots(2, 3, figsize=(15, 8))
    axes = axes.flatten()
    
    axes[0].imshow(test_features, cmap='gray')
    axes[0].set_title('åŒ…å«å¤šç§ç‰¹å¾çš„æµ‹è¯•å›¾åƒ')
    axes[0].axis('off')
    
    for i, (name, kernel) in enumerate(specialized_kernels.items(), 1):
        response = ndimage.convolve(test_features, kernel, mode='constant')
        
        axes[i].imshow(np.abs(response), cmap='hot')
        axes[i].set_title(f'{name}\nä¸“é—¨æ£€æµ‹å¯¹åº”ç‰¹å¾')
        axes[i].axis('off')
        
        print(f"{name}çš„å“åº”ç»Ÿè®¡:")
        print(f"  æœ€å¤§å“åº”: {np.max(np.abs(response)):.2f}")
        print(f"  å¹³å‡å“åº”: {np.mean(np.abs(response)):.2f}")
    
    axes[5].axis('off')
    plt.tight_layout()
    plt.show()

learnable_kernels_demo()
```

## ç°ä»£æ·±åº¦å­¦ä¹ ä¸­çš„å·ç§¯æ ¸

### 1. ä¸åŒå°ºå¯¸çš„å·ç§¯æ ¸

```python
def modern_kernel_sizes():
    """æ¼”ç¤ºç°ä»£æ·±åº¦å­¦ä¹ ä¸­ä¸åŒå°ºå¯¸å·ç§¯æ ¸çš„ä½œç”¨"""
    
    # åˆ›å»ºå¤æ‚çš„æµ‹è¯•å›¾åƒ
    complex_img = np.zeros((100, 100))
    
    # ç»†èŠ‚ç‰¹å¾(å°å°ºåº¦)
    complex_img[10:12, 10:20] = 1
    complex_img[15:17, 15:25] = 1
    
    # ä¸­ç­‰ç‰¹å¾
    complex_img[30:40, 30:40] = 1
    
    # å¤§å°ºåº¦ç‰¹å¾
    complex_img[60:80, 60:80] = 1
    
    # æ·»åŠ å™ªå£°
    noise = np.random.normal(0, 0.1, complex_img.shape)
    complex_img = np.clip(complex_img + noise, 0, 1)
    
    # ä¸åŒå°ºå¯¸çš„å·ç§¯æ ¸
    kernel_sizes = {
        '1Ã—1æ ¸(ç‚¹å·ç§¯)': np.array([[1]]),
        '3Ã—3æ ¸(æ ‡å‡†)': np.array([[-1, -1, -1],
                               [-1,  8, -1],
                               [-1, -1, -1]]) / 8,
        '5Ã—5æ ¸(ä¸­ç­‰æ„Ÿå—é‡)': np.ones((5, 5)) / 25,
        '7Ã—7æ ¸(å¤§æ„Ÿå—é‡)': np.array([
            [0, 0, -1, -1, -1, 0, 0],
            [0, -1, -1, -1, -1, -1, 0],
            [-1, -1, -1, -1, -1, -1, -1],
            [-1, -1, -1, 24, -1, -1, -1],
            [-1, -1, -1, -1, -1, -1, -1],
            [0, -1, -1, -1, -1, -1, 0],
            [0, 0, -1, -1, -1, 0, 0]
        ]) / 24,
    }
    
    fig, axes = plt.subplots(2, 3, figsize=(15, 10))
    axes = axes.flatten()
    
    # åŸå›¾
    axes[0].imshow(complex_img, cmap='gray')
    axes[0].set_title('åŸå§‹å¤æ‚å›¾åƒ\n(åŒ…å«ä¸åŒå°ºåº¦çš„ç‰¹å¾)')
    axes[0].axis('off')
    
    for i, (name, kernel) in enumerate(kernel_sizes.items(), 1):
        if kernel.shape == (1, 1):
            result = complex_img  # 1Ã—1æ ¸ä¿æŒåŸæ ·
        else:
            result = ndimage.convolve(complex_img, kernel, mode='constant')
        
        axes[i].imshow(np.abs(result), cmap='hot')
        axes[i].set_title(f'{name}\næ„Ÿå—é‡: {kernel.shape[0]}Ã—{kernel.shape[1]}')
        axes[i].axis('off')
        
        print(f"{name}:")
        print(f"  æ„Ÿå—é‡å¤§å°: {kernel.shape}")
        print(f"  å‚æ•°æ•°é‡: {kernel.size}")
        print(f"  é€‚åˆæ£€æµ‹: {'åƒç´ çº§ç‰¹å¾' if kernel.shape[0] == 1 else 'ç»†èŠ‚ç‰¹å¾' if kernel.shape[0] <= 3 else 'ä¸­ç­‰ç‰¹å¾' if kernel.shape[0] <= 5 else 'å¤§å°ºåº¦ç‰¹å¾'}")
        print("-" * 30)
    
    # éšè—å¤šä½™å­å›¾
    for i in range(len(kernel_sizes) + 1, len(axes)):
        axes[i].axis('off')
    
    plt.tight_layout()
    plt.show()
    
    # æ¼”ç¤ºæ„Ÿå—é‡çš„æ¦‚å¿µ
    print("æ„Ÿå—é‡æ¦‚å¿µæ¼”ç¤º:")
    print("=" * 40)
    
    receptive_fields = {
        '3Ã—3æ ¸': 3,
        'ä¸¤ä¸ª3Ã—3æ ¸çº§è”': 5,  # (3-1) + (3-1) + 1 = 5
        'ä¸‰ä¸ª3Ã—3æ ¸çº§è”': 7,  # (3-1) + (3-1) + (3-1) + 1 = 7
        'ä¸€ä¸ª7Ã—7æ ¸': 7,
    }
    
    for name, size in receptive_fields.items():
        param_count = 9 if '3Ã—3' in name else 49 if '7Ã—7' in name else 9 * name.count('3Ã—3')
        if 'çº§è”' in name:
            param_count = 9 * name.count('3Ã—3')
        
        print(f"{name}:")
        print(f"  æœ‰æ•ˆæ„Ÿå—é‡: {size}Ã—{size}")
        print(f"  å‚æ•°æ•°é‡: {param_count}")
        print(f"  å‚æ•°æ•ˆç‡: {size*size/param_count:.2f}")

modern_kernel_sizes()
```

### 2. æ·±åº¦å¯åˆ†ç¦»å·ç§¯æ ¸

```python
def depthwise_separable_demo():
    """æ¼”ç¤ºæ·±åº¦å¯åˆ†ç¦»å·ç§¯çš„æ¦‚å¿µ"""
    
    def standard_convolution(image, kernel):
        """æ ‡å‡†å·ç§¯"""
        return ndimage.convolve(image, kernel, mode='constant')
    
    def depthwise_convolution(image, kernel):
        """æ·±åº¦å·ç§¯ï¼ˆæ¯ä¸ªé€šé“ç‹¬ç«‹ï¼‰"""
        # ç®€åŒ–ç‰ˆæœ¬ï¼Œå‡è®¾å•é€šé“
        return ndimage.convolve(image, kernel, mode='constant')
    
    def pointwise_convolution(image, kernel_1x1):
        """ç‚¹å·ç§¯ï¼ˆ1Ã—1å·ç§¯ï¼‰"""
        return ndimage.convolve(image, kernel_1x1, mode='constant')
    
    # åˆ›å»ºæµ‹è¯•å›¾åƒ
    test_image = create_test_image()
    
    # æ ‡å‡†3Ã—3å·ç§¯æ ¸
    standard_kernel = np.array([[-1, 0, 1],
                               [-2, 0, 2],
                               [-1, 0, 1]])
    
    # æ·±åº¦å¯åˆ†ç¦»å·ç§¯: 3Ã—3æ·±åº¦å·ç§¯ + 1Ã—1ç‚¹å·ç§¯
    depthwise_kernel = np.array([[1, 0, -1],
                                [2, 0, -2],
                                [1, 0, -1]]) / 2
    pointwise_kernel = np.array([[1]])
    
    # æ¯”è¾ƒç»“æœ
    standard_result = standard_convolution(test_image, standard_kernel)
    
    # æ·±åº¦å¯åˆ†ç¦»è¿‡ç¨‹
    depthwise_result = depthwise_convolution(test_image, depthwise_kernel)
    separable_result = pointwise_convolution(depthwise_result, pointwise_kernel)
    
    fig, axes = plt.subplots(2, 3, figsize=(15, 8))
    
    # ç¬¬ä¸€è¡Œï¼šè¿‡ç¨‹å±•ç¤º
    axes[0, 0].imshow(test_image, cmap='gray')
    axes[0, 0].set_title('åŸå§‹å›¾åƒ')
    axes[0, 0].axis('off')
    
    axes[0, 1].imshow(depthwise_result, cmap='gray')
    axes[0, 1].set_title('æ·±åº¦å·ç§¯ç»“æœ\n(3Ã—3ç©ºé—´å·ç§¯)')
    axes[0, 1].axis('off')
    
    axes[0, 2].imshow(separable_result, cmap='gray')
    axes[0, 2].set_title('ç‚¹å·ç§¯ç»“æœ\n(1Ã—1æ··åˆ)')
    axes[0, 2].axis('off')
    
    # ç¬¬äºŒè¡Œï¼šå¯¹æ¯”
    axes[1, 0].imshow(standard_result, cmap='gray')
    axes[1, 0].set_title('æ ‡å‡†å·ç§¯\n(ç›´æ¥3Ã—3)')
    axes[1, 0].axis('off')
    
    axes[1, 1].imshow(separable_result, cmap='gray')
    axes[1, 1].set_title('æ·±åº¦å¯åˆ†ç¦»å·ç§¯\n(3Ã—3 + 1Ã—1)')
    axes[1, 1].axis('off')
    
    # å·®å¼‚å›¾
    difference = np.abs(standard_result - separable_result)
    axes[1, 2].imshow(difference, cmap='hot')
    axes[1, 2].set_title('å·®å¼‚å›¾\n(çº¢è‰²=å·®å¼‚å¤§)')
    axes[1, 2].axis('off')
    
    plt.tight_layout()
    plt.show()
    
    # å‚æ•°å¯¹æ¯”
    print("æ·±åº¦å¯åˆ†ç¦»å·ç§¯çš„ä¼˜åŠ¿åˆ†æ:")
    print("=" * 50)
    
    # å‡è®¾è¾“å…¥é€šé“æ•°=è¾“å‡ºé€šé“æ•°=C
    C = 64  # å…¸å‹çš„é€šé“æ•°
    
    standard_params = 3 * 3 * C * C  # æ ‡å‡†å·ç§¯å‚æ•°
    separable_params = 3 * 3 * C + 1 * 1 * C * C  # æ·±åº¦å¯åˆ†ç¦»å‚æ•°
    
    print(f"æ ‡å‡†3Ã—3å·ç§¯å‚æ•°æ•°é‡: 3Ã—3Ã—{C}Ã—{C} = {standard_params:,}")
    print(f"æ·±åº¦å¯åˆ†ç¦»å·ç§¯å‚æ•°: 3Ã—3Ã—{C} + 1Ã—1Ã—{C}Ã—{C} = {separable_params:,}")
    print(f"å‚æ•°å‡å°‘æ¯”ä¾‹: {(1 - separable_params/standard_params)*100:.1f}%")
    print(f"å‚æ•°æ¯”ç‡: 1/{standard_params/separable_params:.1f}")
    
    # è®¡ç®—å¤æ‚åº¦å¯¹æ¯”
    H, W = 224, 224  # å…¸å‹å›¾åƒå°ºå¯¸
    
    standard_ops = H * W * 3 * 3 * C * C
    separable_ops = H * W * 3 * 3 * C + H * W * 1 * 1 * C * C
    
    print(f"\nè®¡ç®—å¤æ‚åº¦å¯¹æ¯”(FLOPs):")
    print(f"æ ‡å‡†å·ç§¯: {standard_ops:,}")
    print(f"æ·±åº¦å¯åˆ†ç¦»: {separable_ops:,}")
    print(f"è®¡ç®—é‡å‡å°‘: {(1 - separable_ops/standard_ops)*100:.1f}%")

depthwise_separable_demo()
```

## å·ç§¯æ ¸çš„å¯è§†åŒ–æŠ€å·§

### ç†è§£å·ç§¯æ ¸çš„ä½œç”¨æœºåˆ¶

```python
def visualize_kernel_mechanics():
    """å¯è§†åŒ–å·ç§¯æ ¸çš„å·¥ä½œæœºåˆ¶"""
    
    def create_step_by_step_convolution(image, kernel):
        """é€æ­¥å±•ç¤ºå·ç§¯è¿‡ç¨‹"""
        img_h, img_w = image.shape
        ker_h, ker_w = kernel.shape
        
        # è¾“å‡ºå°ºå¯¸
        out_h = img_h - ker_h + 1
        out_w = img_w - ker_w + 1
        
        result = np.zeros((out_h, out_w))
        steps = []
        
        for i in range(min(4, out_h)):  # åªå±•ç¤ºå‰4æ­¥
            for j in range(min(4, out_w)):
                # æå–å›¾åƒå—
                patch = image[i:i+ker_h, j:j+ker_w]
                
                # è®¡ç®—å·ç§¯
                conv_value = np.sum(patch * kernel)
                result[i, j] = conv_value
                
                # ä¿å­˜æ­¥éª¤ä¿¡æ¯
                steps.append({
                    'position': (i, j),
                    'patch': patch.copy(),
                    'value': conv_value,
                    'result_so_far': result.copy()
                })
        
        return steps
    
    # åˆ›å»ºç®€å•çš„æµ‹è¯•å›¾åƒ
    simple_img = np.array([
        [0, 0, 1, 1, 0],
        [0, 0, 1, 1, 0],
        [0, 0, 1, 1, 0],
        [0, 0, 1, 1, 0],
        [0, 0, 0, 0, 0]
    ], dtype=float)
    
    # å‚ç›´è¾¹ç¼˜æ£€æµ‹æ ¸
    edge_kernel = np.array([[-1, 1],
                           [-1, 1]])
    
    # è·å–å·ç§¯æ­¥éª¤
    steps = create_step_by_step_convolution(simple_img, edge_kernel)
    
    # å¯è§†åŒ–å‰4ä¸ªæ­¥éª¤
    fig, axes = plt.subplots(2, 4, figsize=(16, 8))
    
    for step_idx in range(min(4, len(steps))):
        step = steps[step_idx]
        pos = step['position']
        patch = step['patch']
        value = step['value']
        
        # æ˜¾ç¤ºå½“å‰å¤„ç†çš„å›¾åƒå—
        axes[0, step_idx].imshow(simple_img, cmap='Blues', alpha=0.3)
        
        # é«˜äº®å½“å‰å¤„ç†åŒºåŸŸ
        highlight = np.zeros_like(simple_img)
        highlight[pos[0]:pos[0]+2, pos[1]:pos[1]+2] = 1
        axes[0, step_idx].imshow(highlight, cmap='Reds', alpha=0.7)
        
        axes[0, step_idx].set_title(f'æ­¥éª¤{step_idx+1}: ä½ç½®({pos[0]},{pos[1]})')
        axes[0, step_idx].axis('off')
        
        # æ˜¾ç¤ºè®¡ç®—è¿‡ç¨‹
        calculation_img = np.zeros((3, 4))
        calculation_img[0, :2] = patch.flatten()[:2]
        calculation_img[1, :2] = patch.flatten()[2:]
        calculation_img[0, 2:] = edge_kernel.flatten()[:2]
        calculation_img[1, 2:] = edge_kernel.flatten()[2:]
        calculation_img[2, 0] = value
        
        axes[1, step_idx].text(0.5, 0.8, f'å›¾åƒå—: [{patch[0,0]:.0f}, {patch[0,1]:.0f}]', 
                              ha='center', transform=axes[1, step_idx].transAxes)
        axes[1, step_idx].text(0.5, 0.6, f'        [{patch[1,0]:.0f}, {patch[1,1]:.0f}]', 
                              ha='center', transform=axes[1, step_idx].transAxes)
        axes[1, step_idx].text(0.5, 0.4, f'å·ç§¯æ ¸: [{edge_kernel[0,0]}, {edge_kernel[0,1]}]', 
                              ha='center', transform=axes[1, step_idx].transAxes)
        axes[1, step_idx].text(0.5, 0.2, f'        [{edge_kernel[1,0]}, {edge_kernel[1,1]}]', 
                              ha='center', transform=axes[1, step_idx].transAxes)
        axes[1, step_idx].text(0.5, 0.05, f'ç»“æœ: {value:.1f}', 
                              ha='center', transform=axes[1, step_idx].transAxes, 
                              fontweight='bold', fontsize=12)
        axes[1, step_idx].set_xlim(0, 1)
        axes[1, step_idx].set_ylim(0, 1)
        axes[1, step_idx].axis('off')
    
    plt.tight_layout()
    plt.show()
    
    # æ˜¾ç¤ºæœ€ç»ˆå®Œæ•´ç»“æœ
    final_result = ndimage.convolve(simple_img, edge_kernel, mode='constant')
    
    fig, axes = plt.subplots(1, 3, figsize=(12, 4))
    
    axes[0].imshow(simple_img, cmap='gray')
    axes[0].set_title('åŸå§‹å›¾åƒ')
    axes[0].axis('off')
    
    # æ˜¾ç¤ºå·ç§¯æ ¸
    axes[1].imshow(edge_kernel, cmap='RdBu')
    axes[1].set_title('å·ç§¯æ ¸')
    for i in range(2):
        for j in range(2):
            axes[1].text(j, i, str(edge_kernel[i,j]), ha='center', va='center', 
                        fontsize=14, fontweight='bold')
    axes[1].axis('off')
    
    axes[2].imshow(final_result, cmap='hot')
    axes[2].set_title('å·ç§¯ç»“æœ\n(æ£€æµ‹åˆ°å‚ç›´è¾¹ç¼˜)')
    axes[2].axis('off')
    
    plt.tight_layout()
    plt.show()
    
    print("å·ç§¯æ ¸å·¥ä½œæœºåˆ¶æ€»ç»“:")
    print("1. å·ç§¯æ ¸åœ¨å›¾åƒä¸Šæ»‘åŠ¨")
    print("2. åœ¨æ¯ä¸ªä½ç½®è¿›è¡Œå…ƒç´ ç›¸ä¹˜å¹¶æ±‚å’Œ")
    print("3. ç»“æœå€¼åæ˜ äº†è¯¥ä½ç½®ä¸å·ç§¯æ ¸æ¨¡å¼çš„åŒ¹é…ç¨‹åº¦")
    print("4. é«˜å€¼è¡¨ç¤ºå¼ºåŒ¹é…ï¼Œä½å€¼è¡¨ç¤ºå¼±åŒ¹é…")

visualize_kernel_mechanics()
```

## å®æˆ˜æŠ€å·§ï¼šå¦‚ä½•è®¾è®¡å·ç§¯æ ¸

### æ ¹æ®éœ€æ±‚å®šåˆ¶å·ç§¯æ ¸

```python
def design_custom_kernels():
    """æ¼”ç¤ºå¦‚ä½•æ ¹æ®éœ€æ±‚è®¾è®¡è‡ªå®šä¹‰å·ç§¯æ ¸"""
    
    def design_pattern_detector(pattern):
        """æ ¹æ®æ¨¡å¼è®¾è®¡æ£€æµ‹æ ¸"""
        # å°†æ¨¡å¼è½¬æ¢ä¸ºæ£€æµ‹æ ¸
        kernel = pattern.astype(float)
        # å½’ä¸€åŒ–
        if np.sum(kernel) != 0:
            kernel = kernel / np.sum(kernel)
        return kernel
    
    def design_edge_enhancer(direction='all'):
        """è®¾è®¡è¾¹ç¼˜å¢å¼ºæ ¸"""
        if direction == 'horizontal':
            return np.array([[-1, -1, -1],
                           [ 0,  0,  0],
                           [ 1,  1,  1]])
        elif direction == 'vertical':
            return np.array([[-1, 0, 1],
                           [-1, 0, 1],
                           [-1, 0, 1]])
        else:  # all directions
            return np.array([[-1, -1, -1],
                           [-1,  8, -1],
                           [-1, -1, -1]])
    
    def design_noise_reducer(strength='medium'):
        """è®¾è®¡é™å™ªæ ¸"""
        if strength == 'light':
            return np.array([[1, 1, 1],
                           [1, 2, 1],
                           [1, 1, 1]]) / 10
        elif strength == 'medium':
            return np.array([[1, 2, 1],
                           [2, 4, 2],
                           [1, 2, 1]]) / 16
        else:  # strong
            return np.ones((5, 5)) / 25
    
    # åˆ›å»ºåŒ…å«ä¸åŒé—®é¢˜çš„æµ‹è¯•å›¾åƒ
    test_img = np.zeros((80, 80))
    
    # æ·»åŠ æ°´å¹³çº¿æ¡
    test_img[20:22, 10:70] = 1
    # æ·»åŠ å‚ç›´çº¿æ¡  
    test_img[30:70, 20:22] = 1
    # æ·»åŠ å™ªç‚¹
    noise_mask = np.random.rand(80, 80) < 0.05
    test_img[noise_mask] = 1
    # æ·»åŠ æ¨¡ç³Šè¾¹ç¼˜
    test_img[50:60, 50:70] = 0.5
    
    # è®¾è®¡è§£å†³æ–¹æ¡ˆ
    solutions = {
        'åŸå›¾': test_img,
        'æ°´å¹³è¾¹ç¼˜å¢å¼º': design_edge_enhancer('horizontal'),
        'å‚ç›´è¾¹ç¼˜å¢å¼º': design_edge_enhancer('vertical'),
        'å…¨æ–¹å‘è¾¹ç¼˜': design_edge_enhancer('all'),
        'è½»åº¦é™å™ª': design_noise_reducer('light'),
        'å¼ºåŠ›é™å™ª': design_noise_reducer('strong'),
    }
    
    fig, axes = plt.subplots(2, 3, figsize=(15, 10))
    axes = axes.flatten()
    
    for i, (name, kernel_or_img) in enumerate(solutions.items()):
        if name == 'åŸå›¾':
            result = kernel_or_img
        else:
            result = ndimage.convolve(test_img, kernel_or_img, mode='constant')
        
        axes[i].imshow(result, cmap='gray')
        axes[i].set_title(name)
        axes[i].axis('off')
        
        if name != 'åŸå›¾':
            print(f"{name}å·ç§¯æ ¸:")
            print(kernel_or_img)
            print(f"ç”¨é€”: {name}")
            print("-" * 30)
    
    plt.tight_layout()
    plt.show()
    
    # æ¼”ç¤ºç»„åˆç­–ç•¥
    print("ç»„åˆç­–ç•¥æ¼”ç¤º:")
    print("=" * 40)
    
    # ç­–ç•¥1: å…ˆé™å™ªå†è¾¹ç¼˜æ£€æµ‹
    denoised = ndimage.convolve(test_img, design_noise_reducer('medium'), mode='constant')
    edges_after_denoise = ndimage.convolve(denoised, design_edge_enhancer('all'), mode='constant')
    
    # ç­–ç•¥2: å…ˆè¾¹ç¼˜æ£€æµ‹å†é™å™ª
    edges_first = ndimage.convolve(test_img, design_edge_enhancer('all'), mode='constant')
    denoised_edges = ndimage.convolve(edges_first, design_noise_reducer('light'), mode='constant')
    
    fig, axes = plt.subplots(1, 4, figsize=(16, 4))
    
    axes[0].imshow(test_img, cmap='gray')
    axes[0].set_title('åŸå›¾(å«å™ªå£°)')
    axes[0].axis('off')
    
    axes[1].imshow(np.abs(edges_after_denoise), cmap='gray')
    axes[1].set_title('ç­–ç•¥1: å…ˆé™å™ªåè¾¹ç¼˜æ£€æµ‹')
    axes[1].axis('off')
    
    axes[2].imshow(np.abs(denoised_edges), cmap='gray')
    axes[2].set_title('ç­–ç•¥2: å…ˆè¾¹ç¼˜æ£€æµ‹åé™å™ª')
    axes[2].axis('off')
    
    # æ¯”è¾ƒå·®å¼‚
    difference = np.abs(edges_after_denoise - denoised_edges)
    axes[3].imshow(difference, cmap='hot')
    axes[3].set_title('ä¸¤ç§ç­–ç•¥çš„å·®å¼‚')
    axes[3].axis('off')
    
    plt.tight_layout()
    plt.show()
    
    print("è®¾è®¡å»ºè®®:")
    print("1. å…ˆæ˜ç¡®è¦æ£€æµ‹/å¢å¼ºçš„ç‰¹å¾")
    print("2. æ ¹æ®ç‰¹å¾è®¾è®¡ç›¸åº”çš„æ¨¡å¼")
    print("3. è€ƒè™‘å½’ä¸€åŒ–ä»¥æ§åˆ¶è¾“å‡ºèŒƒå›´")
    print("4. æµ‹è¯•ä¸åŒå‚æ•°çš„æ•ˆæœ")
    print("5. è€ƒè™‘ä¸å…¶ä»–æ ¸çš„ç»„åˆä½¿ç”¨")

design_custom_kernels()
```

## æ€»ç»“ï¼šå·ç§¯æ ¸çš„æ™ºæ…§

å·ç§¯æ ¸å°±åƒæ˜¯å›¾åƒä¸–ç•Œçš„**ç‘å£«å†›åˆ€**ï¼š

### ğŸ¯ æ ¸å¿ƒæœ¬è´¨

1. **æ¨¡å¼åŒ¹é…å™¨**ï¼šæ£€æµ‹å›¾åƒä¸­çš„ç‰¹å®šæ¨¡å¼
2. **ç‰¹å¾æå–å™¨**ï¼šä»å¤æ‚ä¿¡æ¯ä¸­æå–æœ‰ç”¨ç‰¹å¾  
3. **ä¿¡å·å˜æ¢å™¨**ï¼šå°†è¾“å…¥ä¿¡å·è½¬æ¢ä¸ºæœŸæœ›çš„è¾“å‡º
4. **æ™ºèƒ½æ»¤é•œ**ï¼šæœ‰é€‰æ‹©æ€§åœ°å¤„ç†ä¸åŒç±»å‹çš„ä¿¡æ¯

### ğŸ”§ è®¾è®¡åŸåˆ™

- **ç›®æ ‡å¯¼å‘**ï¼šæ ¹æ®è¦æ£€æµ‹çš„ç‰¹å¾è®¾è®¡æ ¸
- **æ•°å­¦çº¦æŸ**ï¼šæ³¨æ„æ ¸çš„å’Œã€å¯¹ç§°æ€§ç­‰æ€§è´¨
- **å°ºå¯¸é€‰æ‹©**ï¼šæ„Ÿå—é‡è¦ä¸ç‰¹å¾å°ºåº¦åŒ¹é…
- **ç»„åˆæ€ç»´**ï¼šå¤šä¸ªç®€å•æ ¸èƒœè¿‡ä¸€ä¸ªå¤æ‚æ ¸

### ğŸ’ª åº”ç”¨ç­–ç•¥

1. **è¾¹ç¼˜æ£€æµ‹**ï¼šä½¿ç”¨é«˜é€šæ»¤æ³¢æ ¸
2. **å›¾åƒå¹³æ»‘**ï¼šä½¿ç”¨ä½é€šæ»¤æ³¢æ ¸
3. **ç‰¹å¾å¢å¼º**ï¼šä½¿ç”¨é”åŒ–æ ¸
4. **å™ªå£°æŠ‘åˆ¶**ï¼šä½¿ç”¨å¹³å‡æ ¸æˆ–é«˜æ–¯æ ¸

### ğŸ§  æ·±åº¦å­¦ä¹ ä¸­çš„è¿›åŒ–

- **ä»æ‰‹å·¥åˆ°å­¦ä¹ **ï¼šä»äººå·¥è®¾è®¡åˆ°è‡ªåŠ¨å­¦ä¹ 
- **ä»å›ºå®šåˆ°è‡ªé€‚åº”**ï¼šæ ¹æ®æ•°æ®è‡ªåŠ¨è°ƒæ•´
- **ä»ç®€å•åˆ°å¤æ‚**ï¼šå¤šå±‚æ¬¡ç‰¹å¾æå–
- **ä»å•ä¸€åˆ°å¤šæ ·**ï¼šä¸åŒæ ¸æ£€æµ‹ä¸åŒç‰¹å¾

### ğŸª è®°å¿†å£è¯€

"**å°çŸ©é˜µï¼Œå¤§æ™ºæ…§ï¼Œæ»‘çª—æ‰«ï¼Œç‰¹å¾ç°ï¼Œç»„åˆç”¨ï¼Œæ•ˆæœæ˜¾**"

å·ç§¯æ ¸è™½å°ï¼Œå´æ‰¿è½½ç€è®¡ç®—æœºè§†è§‰çš„æ ¸å¿ƒæ™ºæ…§ã€‚ä»Instagramçš„ç¾é¢œæ»¤é•œåˆ°è‡ªåŠ¨é©¾é©¶çš„ç‰©ä½“è¯†åˆ«ï¼Œä»åŒ»å­¦å½±åƒçš„ç—…ç¶æ£€æµ‹åˆ°å«æ˜Ÿå›¾åƒçš„åœ°ç‰©åˆ†ç±»ï¼Œå·ç§¯æ ¸æ— å¤„ä¸åœ¨ï¼Œé»˜é»˜åœ°è®©æœºå™¨æ‹¥æœ‰äº†"çœ‹æ‡‚"ä¸–ç•Œçš„èƒ½åŠ›ï¼

æŒæ¡äº†å·ç§¯æ ¸ï¼Œä½ å°±æŒæ¡äº†æ‰“å¼€è®¡ç®—æœºè§†è§‰å¤§é—¨çš„é’¥åŒ™ï¼ğŸ”‘

---

**ä½œè€…**: meimeitou  
